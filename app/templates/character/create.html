{% extends "base.html" %}

{% block title %}Create Character{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <h1 class="text-center mb-4">Create New Character</h1>
            
            <form method="POST" class="bg-secondary p-4 rounded">
                {{ form.hidden_tag() }}
                
                <!-- Basic Info -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="mb-0">Basic Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.name.label(class="form-label") }}
                            {{ form.name(class="form-control") }}
                            {% for error in form.name.errors %}
                                <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.race.label(class="form-label") }}
                                {{ form.race(class="form-control") }}
                                {% for error in form.race.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-6">
                                {{ form.character_class.label(class="form-label") }}
                                {{ form.character_class(class="form-control") }}
                                {% for error in form.character_class.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                {{ form.level.label(class="form-label") }}
                                {{ form.level(class="form-control") }}
                                {% for error in form.level.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4">
                                {{ form.alignment.label(class="form-label") }}
                                {{ form.alignment(class="form-control") }}
                                {% for error in form.alignment.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4">
                                {{ form.background.label(class="form-label") }}
                                {{ form.background(class="form-control") }}
                                {% for error in form.background.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ability Scores -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="mb-0">Ability Scores</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.strength.label(class="form-label") }}
                                {{ form.strength(class="form-control", id="strength") }}
                                {% for error in form.strength.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.dexterity.label(class="form-label") }}
                                {{ form.dexterity(class="form-control", id="dexterity") }}
                                {% for error in form.dexterity.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.constitution.label(class="form-label") }}
                                {{ form.constitution(class="form-control", id="constitution") }}
                                {% for error in form.constitution.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                {{ form.intelligence.label(class="form-label") }}
                                {{ form.intelligence(class="form-control", id="intelligence") }}
                                {% for error in form.intelligence.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.wisdom.label(class="form-label") }}
                                {{ form.wisdom(class="form-control", id="wisdom") }}
                                {% for error in form.wisdom.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 mb-3">
                                {{ form.charisma.label(class="form-label") }}
                                {{ form.charisma(class="form-control", id="charisma") }}
                                {% for error in form.charisma.errors %}
                                    <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipment -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="mb-0">Equipment</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            {{ form.equipment.label(class="form-label") }}
                            {{ form.equipment(class="form-control", rows=4) }}
                            {% for error in form.equipment.errors %}
                                <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="mb-3">
                            {{ form.gold.label(class="form-label") }}
                            {{ form.gold(class="form-control") }}
                            {% for error in form.gold.errors %}
                                <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    {{ form.submit(class="btn btn-primary btn-lg") }}
                    <a href="{{ url_for('character.list_characters') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add JavaScript for ability score calculations -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const abilityScores = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'];
    
    function calculateModifier(score) {
        return Math.floor((score - 10) / 2);
    }
    
    abilityScores.forEach(ability => {
        const input = document.getElementById(ability);
        const label = input.previousElementSibling;
        
        input.addEventListener('input', function() {
            const score = parseInt(this.value) || 0;
            const modifier = calculateModifier(score);
            const modifierText = modifier >= 0 ? `+${modifier}` : modifier;
            label.textContent = `${label.textContent.split('(')[0]} (${modifierText})`;
        });
        
        // Initialize labels with modifiers
        const initialScore = parseInt(input.value) || 0;
        const initialModifier = calculateModifier(initialScore);
        const modifierText = initialModifier >= 0 ? `+${initialModifier}` : initialModifier;
        label.textContent = `${label.textContent.split('(')[0]} (${modifierText})`;
    });
});
</script>
{% endblock %}
