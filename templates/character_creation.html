{% extends "base.html" %}

{% block title %}Character Creation{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card bg-secondary">
        <div class="card-header">
            <h2 class="mb-0">Create a New Character</h2>
        </div>
        <div class="card-body">
            <form id="characterForm" method="POST" action="{{ url_for('save_character') }}">
                <!-- Basic Info -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="name" class="form-label">Character Name</label>
                            <input type="text" id="name" name="name" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="rank" class="form-label">Rank</label>
                            <select id="rank" name="rank" class="form-select" required>
                                <option value="Novice">Novice</option>
                                <option value="Seasoned">Seasoned</option>
                                <option value="Veteran">Veteran</option>
                                <option value="Heroic">Heroic</option>
                                <option value="Legendary">Legendary</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Race and Concept -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="race" class="form-label">Race</label>
                            <input type="text" id="race" name="race" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="concept" class="form-label">Character Concept</label>
                            <input type="text" id="concept" name="concept" class="form-control" placeholder="e.g., Grizzled Veteran, Street Mage, etc." required>
                        </div>
                    </div>
                </div>

                <!-- Attributes -->
                <h4 class="mb-3">Attributes</h4>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="agility" class="form-label">Agility</label>
                            <select id="agility" name="agility" class="form-select" required>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d10">d10</option>
                                <option value="d12">d12</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="smarts" class="form-label">Smarts</label>
                            <select id="smarts" name="smarts" class="form-select" required>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d10">d10</option>
                                <option value="d12">d12</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="spirit" class="form-label">Spirit</label>
                            <select id="spirit" name="spirit" class="form-select" required>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d10">d10</option>
                                <option value="d12">d12</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="strength" class="form-label">Strength</label>
                            <select id="strength" name="strength" class="form-select" required>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d10">d10</option>
                                <option value="d12">d12</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="vigor" class="form-label">Vigor</label>
                            <select id="vigor" name="vigor" class="form-select" required>
                                <option value="d4">d4</option>
                                <option value="d6">d6</option>
                                <option value="d8">d8</option>
                                <option value="d10">d10</option>
                                <option value="d12">d12</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Derived Stats -->
                <h4 class="mb-3">Derived Stats</h4>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="pace" class="form-label">Pace</label>
                            <input type="number" id="pace" name="pace" class="form-control" value="6" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="parry" class="form-label">Parry</label>
                            <input type="number" id="parry" name="parry" class="form-control" value="2" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="toughness" class="form-label">Toughness</label>
                            <input type="number" id="toughness" name="toughness" class="form-control" value="4" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label for="charisma" class="form-label">Charisma</label>
                            <input type="number" id="charisma" name="charisma" class="form-control" value="0" required>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <h4 class="mb-3">Skills</h4>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="core_skills" class="form-label">Core Skills</label>
                            <textarea id="core_skills" name="core_skills" class="form-control" rows="4" 
                                placeholder="Format: Skill Name (die type), e.g., Fighting (d6), Shooting (d8)"></textarea>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="knowledge_skills" class="form-label">Knowledge Skills</label>
                            <textarea id="knowledge_skills" name="knowledge_skills" class="form-control" rows="4"
                                placeholder="Format: Knowledge (Area) (die type), e.g., Knowledge (History) (d6)"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Edges and Hindrances -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="edges" class="form-label">Edges</label>
                            <textarea id="edges" name="edges" class="form-control" rows="3"
                                placeholder="List your character's edges"></textarea>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="hindrances" class="form-label">Hindrances</label>
                            <textarea id="hindrances" name="hindrances" class="form-control" rows="3"
                                placeholder="List your character's hindrances"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Powers -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="powers" class="form-label">Powers</label>
                            <textarea id="powers" name="powers" class="form-control" rows="3"
                                placeholder="List your character's powers (if any)"></textarea>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="power_points" class="form-label">Power Points</label>
                            <input type="number" id="power_points" name="power_points" class="form-control" value="0" min="0">
                        </div>
                    </div>
                </div>

                <!-- Gear and Resources -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="money" class="form-label">Money</label>
                            <input type="number" id="money" name="money" class="form-control" value="500" min="0">
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Create Character</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('characterForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    fetch("{{ url_for('save_character') }}", {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.message === 'Character saved successfully') {
            window.location.href = "{{ url_for('view_characters') }}";
        } else {
            alert('Error saving character: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while saving the character');
    });
});
</script>
{% endblock %}